# 摇篮留言服务系统 - 功能特性

本文档详细介绍摇篮留言服务系统的核心功能特性。

## 1. 用户管理

### 1.1 用户认证

- **登录系统**
  - 基于Flask-Login的会话认证
  - 用户名/密码认证方式
  - 登录失败提示

- **注销登录**
  - 会话销毁
  - 安全退出
  - 重定向到首页

- **API认证**
  - 基于JWT的API认证
  - Token过期机制
  - 请求验证机制

### 1.2 用户权限

- **普通用户**
  - 创建和管理自己的留言
  - 响应预警通知
  - 查看留言状态

- **管理员**
  - 访问管理后台
  - 查看系统统计数据
  - 管理用户和留言

## 2. 留言管理

### 2.1 留言创建

- **创建留言**
  - 填写留言内容
  - 设置初始延迟时间
  - 添加接收人信息
  - 生成唯一撤销密钥

- **留言设置**
  - 选择初始延迟月数（1, 3, 6, 12, 24, 36, 48, 60个月）
  - 设置多个接收人
  - 支持多种联系方式（邮件、手机、微信）

- **撤销密钥**
  - 基于Fernet加密生成
  - 唯一标识每条留言
  - 用于撤销留言的凭证

### 2.2 留言撤销

- **撤销机制**
  - 通过撤销密钥撤销
  - 无需登录即可撤销
  - 撤销后状态不可逆

- **状态记录**
  - 记录撤销操作
  - 记录撤销时间
  - 保留撤销历史

## 3. 预警系统

### 3.1 预警机制

- **预警级别**
  - 第0级：初始状态
  - 第1级：首次预警（初始延迟后）
  - 第2级：第二次预警（30天后）
  - 第3级：第三次预警（30天后）
  - 第4级：第四次预警（7天后）
  - 第5级：最终预警（1天后）

- **预警时间表**
  - 自动计算预警时间表
  - 显示完整预警时间点
  - 基于初始延迟时间动态计算

### 3.2 预警响应

- **响应选项**
  - RESET：重置预警周期
  - CONTINUE：继续预警流程

- **响应处理**
  - 重置：将预警级别重置为0，恢复初始延迟时间
  - 继续：提升预警级别，更新下次预警时间
  - 记录响应结果

### 3.3 状态追踪

- **状态记录**
  - 记录预警状态变更（WARNING_1到WARNING_5）
  - 记录用户响应（RESET或CONTINUE）
  - 记录撤销操作（REVOKED）

- **日志记录**
  - 记录状态变更时间
  - 记录详细操作信息
  - 保存响应类型

## 4. 接收人管理

### 4.1 接收人信息

- **基本信息**
  - 接收人姓名
  - 联系方式
  - 联系类型

- **联系类型**
  - 电子邮件（email）
  - 手机号码（phone）
  - 微信号（wechat）

### 4.2 多接收人支持

- **添加多个接收人**
  - 一个留言可设置多个接收人
  - 支持不同联系方式的接收人
  - 通过前端界面动态添加

- **接收人管理**
  - 留言创建时指定接收人
  - 所有接收人信息关联到特定留言
  - 留言发送时通知所有接收人

## 5. 管理后台

### 5.1 系统概览

- **统计数据**
  - 用户总数
  - 留言总数
  - 活跃留言数量

- **预警统计**
  - 各级别预警留言数量（level1-level5）
  - 活跃留言状态分布
  - 预警级别分布数据

### 5.2 管理功能

- **显示基本统计**
  - 直观展示系统状态
  - 实时统计数据
  - 按预警级别统计留言

## 6. 安全特性

### 6.1 数据加密

- **内容加密**
  - 使用Cryptography库的Fernet加密
  - 敏感信息加密存储
  - 密钥安全管理

- **撤销密钥**
  - 随机生成的唯一密钥
  - 使用base64编码存储
  - 安全的密钥传递

### 6.2 访问控制

- **身份验证**
  - 表单登录认证
  - JWT API认证
  - 会话管理

- **权限控制**
  - 基于角色的访问控制
  - 资源访问限制
  - 管理后台访问限制

### 6.3 操作日志

- **日志记录**
  - 记录登录/登出操作
  - 记录留言创建和撤销
  - 记录预警响应处理

- **异常记录**
  - 捕获和记录系统异常
  - 记录错误信息和堆栈
  - 便于问题排查

## 7. 前端界面

### 7.1 用户界面

- **响应式设计**
  - 适配不同设备
  - 简洁直观的布局
  - 一致的交互体验

- **主要页面**
  - 首页/留言创建页
  - 登录页
  - 管理后台页

### 7.2 交互体验

- **留言创建**
  - 简洁表单设计
  - 动态添加接收人
  - 预警机制说明展示

- **状态反馈**
  - 操作成功提示
  - 错误信息展示
  - 登录状态显示

## 8. 系统结构

### 8.1 目录结构

- **主要文件**
  - app.py: 主应用入口
  - models.py: 数据模型定义
  - config/config.py: 系统配置

- **资源目录**
  - templates/: HTML模板
  - static/: 静态资源
  - logs/: 日志文件

### 8.2 配置管理

- **系统配置**
  - 密钥和加密配置
  - 数据库连接配置
  - JWT配置

- **预警配置**
  - 预警间隔配置
  - 管理员账户配置
  - 上传文件限制配置 