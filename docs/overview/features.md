# 摇篮留言服务系统 - 功能特性

本文档详细介绍摇篮留言服务系统的核心功能特性。

## 1. 用户管理

### 1.1 用户认证

- **登录系统**
  - 基于Flask-Login的会话认证
  - 用户名/密码认证方式
  - 登录失败提示

- **注销登录**
  - 会话销毁
  - 安全退出
  - 重定向到首页

- **API认证**
  - 基于JWT的API认证
  - Token过期机制
  - 请求验证机制

### 1.2 用户权限

- **普通用户**
  - 创建和管理自己的留言
  - 响应预警通知
  - 查看留言状态

- **管理员**
  - 访问管理后台
  - 查看系统统计数据
  - 管理用户和留言

## 2. 留言管理

### 2.1 留言创建

- **创建留言**
  - 填写留言内容
  - 设置初始延迟时间
  - 添加接收人信息
  - 生成唯一撤销密钥

- **留言设置**
  - 选择初始延迟月数
  - 设置多个接收人
  - 支持多种联系方式（邮件、手机、微信）

- **撤销密钥**
  - 基于Fernet加密生成
  - 唯一标识每条留言
  - 用于撤销留言的凭证

### 2.2 留言撤销

- **撤销机制**
  - 通过撤销密钥撤销
  - 无需登录即可撤销
  - 撤销后状态不可逆

- **状态记录**
  - 记录撤销操作
  - 记录撤销时间
  - 保留撤销历史

## 3. 预警系统

### 3.1 预警机制

- **预警级别**
  - 第0级：初始状态
  - 第1级：首次预警（初始延迟后）
  - 第2级：第二次预警（30天后）
  - 第3级：第三次预警（30天后）
  - 第4级：第四次预警（7天后）
  - 第5级：最终预警（1天后）

- **预警时间表**
  - 自动计算预警时间
  - 显示完整预警时间表
  - 基于初始设置动态调整

### 3.2 预警响应

- **响应选项**
  - RESET：重置预警周期
  - CONTINUE：继续预警流程

- **响应处理**
  - 重置：将预警级别重置为0
  - 继续：提升预警级别，更新下次预警时间
  - 记录响应结果

### 3.3 状态追踪

- **状态记录**
  - 记录预警状态变更
  - 记录用户响应
  - 保存详细状态日志

- **时间轴展示**
  - 按时间顺序显示预警历史
  - 显示预警响应记录
  - 完整的时间戳信息

## 4. 接收人管理

### 4.1 接收人信息

- **基本信息**
  - 接收人姓名
  - 联系方式
  - 联系类型

- **联系类型**
  - 电子邮件
  - 手机号码
  - 微信号

### 4.2 多接收人支持

- **添加多个接收人**
  - 同一留言可设置多个接收人
  - 不同联系方式的接收人
  - 批量添加接收人

- **接收人验证**
  - 验证联系方式格式
  - 确保信息完整性
  - 防止无效联系方式

## 5. 管理后台

### 5.1 系统概览

- **统计数据**
  - 用户总数
  - 留言总数
  - 活跃留言数量

- **预警统计**
  - 各级别预警留言数量
  - 预警响应情况
  - 留言状态分布

### 5.2 管理功能

- **用户管理**
  - 查看用户列表
  - 用户权限管理
  - 用户状态管理

- **留言管理**
  - 查看所有留言
  - 留言状态管理
  - 留言详情查看

## 6. 安全特性

### 6.1 数据加密

- **内容加密**
  - 使用Cryptography库的Fernet加密
  - 敏感信息加密存储
  - 密钥安全管理

- **撤销密钥**
  - 随机生成的唯一密钥
  - 使用base64编码存储
  - 安全的密钥传递

### 6.2 访问控制

- **身份验证**
  - 表单登录认证
  - JWT API认证
  - 会话管理

- **权限控制**
  - 基于角色的访问控制
  - 资源访问限制
  - 敏感操作保护

### 6.3 操作日志

- **日志记录**
  - 记录关键操作
  - 记录异常情况
  - 时间戳和详细信息

- **审计功能**
  - 操作追踪
  - 行为分析
  - 异常检测

## 7. 前端界面

### 7.1 用户界面

- **响应式设计**
  - 适配不同设备
  - 简洁直观的布局
  - 一致的交互体验

- **主要页面**
  - 首页
  - 登录页
  - 留言创建页
  - 管理后台页

### 7.2 交互体验

- **表单交互**
  - 智能表单验证
  - 即时反馈
  - 错误提示

- **状态反馈**
  - 操作成功提示
  - 错误信息展示
  - 加载状态指示

## 8. 系统扩展性

### 8.1 模块化设计

- **核心模块**
  - 用户认证模块
  - 留言管理模块
  - 预警系统模块
  - 管理后台模块

- **接口设计**
  - 清晰的模块边界
  - 标准化的接口定义
  - 松耦合的组件架构

### 8.2 配置管理

- **环境配置**
  - 开发环境配置
  - 测试环境配置
  - 生产环境配置

- **功能配置**
  - 预警时间配置
  - 管理员账号配置
  - 系统参数配置

## 9. 技术栈特性

### 9.1 后端技术

- **Flask框架**
  - 轻量级Web框架
  - 灵活的路由系统
  - 简洁的应用结构

- **数据库ORM**
  - SQLAlchemy ORM映射
  - 数据模型定义
  - 关系映射

### 9.2 前端技术

- **模板引擎**
  - Jinja2模板渲染
  - 模板继承和复用
  - 条件渲染和循环

- **前端交互**
  - 原生JavaScript
  - 表单交互
  - AJAX请求 